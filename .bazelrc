common --enable_bzlmod

try-import %workspace%/ci.bazelrc
try-import %workspace%/user.bazelrc

build --enable_platform_specific_config
build:macos --apple_crosstool_top=@local_config_apple_cc//:toolchain
build:macos --crosstool_top=@local_config_apple_cc//:toolchain
build:macos --host_crosstool_top=@local_config_apple_cc//:toolchain

build:macos --macos_minimum_os=13.5 --host_macos_minimum_os=13.5
build --disk_cache=~/.bazel_cache
build --experimental_remote_cache_compression
build --remote_build_event_upload=minimal
build --nolegacy_important_outputs
build --incompatible_strict_action_env

build:windows \
  --repo_env=BAZEL_LLVM=C:/Software/swift/Toolchains/6.2.1+Asserts/usr \
  --extra_toolchains=@local_config_cc//:cc-toolchain-x64_windows-clang-cl \
  --extra_execution_platforms=//:x64_windows-clang-cl \
  --features=-compiler_param_file \
  --host_features=-compiler_param_file \
  --features=-archive_param_file

build:release \
  --compilation_mode=opt \
  --features=swift.opt_uses_wmo
